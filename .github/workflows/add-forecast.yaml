name: add-forecast-set
on:
  push:
    paths-ignore:
      - '.dvc/**'
      - dvc.lock
      - 'metrics/**'
      - README.md
    branches:
      - '*'
      - '!master'
jobs:
  backtest1:
    name: Train and forecast set 1
    runs-on: ubuntu-latest
    container: docker://eamon/sir-kf:2021-02-22
    strategy:
      matrix:
        fips: [36, 53]
    steps:
      - uses: actions/checkout@v2
      - name: Echo inputs
        env:
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          loc: ${{ matrix.fips }}
        run: |
          dvc pull --run-cache || true
          loc=$loc bash -x ./forecast.sh
          dvc push --run-cache
          git config --local user.email "actions@users.noreply.github.com"
          git config --local user.name "Automated Publisher"
          git add dvc.yaml dvc.lock metrics visuals
          git commit -m "Forecast pipeline additions" && git push
