stages:
  hopkins-2020-10-12:
    cmd: fdt=2020-10-12 ./pull-hopkins-ts-from-date.R
    deps:
    - pull-hopkins-ts-from-date.R
    outs:
    - hopkins/2020-10-12
  hopkins-2021-01-11:
    cmd: fdt=2021-01-11 ./pull-hopkins-ts-from-date.R
    deps:
    - pull-hopkins-ts-from-date.R
    outs:
    - hopkins/2021-01-11
  score-2021-01-11:
    cmd: ddt=2021-01-11 ./quantile-score.R
    deps:
    - covidhub-common.R
    - forecasts
    - hopkins/2021-01-11
    - quantile-score.R
    outs:
    - metrics/2021-01-11-residuals.rds
    plots:
    - metrics/2021-01-11-score-by-loc-type-targ-type-forecast-date.csv:
        cache: false
        template: lqs-loctype-targtype-panels
        x: forecast_date
    - metrics/2021-01-11-score-by-loc-type-targ-type.csv:
        cache: false
        template: lqs-loctype-panel
        x: target_type
    - metrics/2021-01-11-score-by-loc-type.csv:
        cache: false
        template: lqs
        x: loc_type
        x_label: Location type
  data-prep-2020-10-12-36:
    cmd: fdt=2020-10-12 loc=36 Rscript infection-kalman-data-prep.R
    deps:
    - covidhub-common.R
    - hopkins/2020-10-12
    - infection-kalman-data-prep.R
    outs:
    - data--2020-10-12--36.csv
    - initial-pars--2020-10-12--36.csv
  data-fit-2020-10-12-36:
    cmd: julia InfectionKalmanMain.jl 2020-10-12 36
    deps:
    - InfectionKalman.jl
    - InfectionKalmanMain.jl
    - data--2020-10-12--36.csv
    - initial-pars--2020-10-12--36.csv
    outs:
    - minimizer--2020-10-12--36.csv
  write-forecast-2020-10-12-36:
    cmd: fdt=2020-10-12 loc=36 Rscript infection-kalman-process-results.R
    deps:
    - data--2020-10-12--36.csv
    - infection-kalman-process-results.R
    - minimizer--2020-10-12--36.csv
    outs:
    - forecasts/2020-10-12-CEID-InfectionKalman.csv
  hopkins-2020-10-05:
    cmd: fdt=2020-10-05 ./pull-hopkins-ts-from-date.R
    deps:
    - pull-hopkins-ts-from-date.R
    outs:
    - hopkins/2020-10-05
  data-prep-2020-10-05-36:
    cmd: fdt=2020-10-05 loc=36 Rscript infection-kalman-data-prep.R
    deps:
    - covidhub-common.R
    - hopkins/2020-10-05
    - infection-kalman-data-prep.R
    outs:
    - data--2020-10-05--36.csv
    - initial-pars--2020-10-05--36.csv
  data-fit-2020-10-05-36:
    cmd: julia InfectionKalmanMain.jl 2020-10-05 36
    deps:
    - InfectionKalman.jl
    - InfectionKalmanMain.jl
    - data--2020-10-05--36.csv
    - initial-pars--2020-10-05--36.csv
    outs:
    - minimizer--2020-10-05--36.csv
  write-forecast-2020-10-05-36:
    cmd: fdt=2020-10-05 loc=36 Rscript infection-kalman-process-results.R
    deps:
    - data--2020-10-05--36.csv
    - infection-kalman-process-results.R
    - minimizer--2020-10-05--36.csv
    outs:
    - forecasts/2020-10-05-CEID-InfectionKalman.csv
